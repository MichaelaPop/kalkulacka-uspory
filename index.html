<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KalkulaÄka Ãºspor â€“ Alcasys</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
:root{
  --text:#0f172a; --muted:#667085; --accent:#2563eb; --accent-d:#1e40af; --ring:rgba(37,99,235,.35);
  --card:#ffffff; --ok:#16a34a; --err:#dc2626;
}

/* GlobÃ¡lnÃ­ fixy proti pÅ™etÃ©kÃ¡nÃ­ na mobilu */
html,body{
  margin:0; min-height:100vh; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:var(--text); line-height:1.6; font-size:17px; overflow-x:hidden;
  -webkit-text-size-adjust:100%;
  background:
    radial-gradient(80% 120% at 0% 0%, #eaf2ff 0%, transparent 60%),
    radial-gradient(80% 120% at 100% 0%, #f0f6ff 0%, transparent 60%),
    linear-gradient(180deg,#f7faff 0%, #ffffff 60%);
  background-attachment: local;
}
/* AÅ¥ se Å¡Ã­Å™ky poÄÃ­tajÃ­ vÄetnÄ› padding/border */
*,*::before,*::after{ box-sizing:border-box }

/* Obal a karta */
.wrap{max-width:560px;margin:28px auto;padding:0 16px}
.card{position:relative;background:var(--card);border-radius:22px;box-shadow:0 18px 48px rgba(2,6,23,.12);padding:22px 22px 18px;overflow:hidden}
.card::before{content:"";position:absolute;inset:0 0 auto 0;height:3px;border-radius:22px 22px 0 0;background:linear-gradient(90deg,#60a5fa,#2563eb,#7c3aed);opacity:.9}

/* Progress bar */
.progress{height:8px;background:#e9eef9;border-radius:999px;overflow:hidden;margin:6px 0 16px}
.progress>span{display:block;height:100%;width:33.333%;background:linear-gradient(90deg,#60a5fa,#2563eb);transition:width .25s ease}

/* Sloupec pro pole */
.form-narrow{max-width:480px;margin:0 auto;width:100%}

/* Typografie */
h1{margin:0 0 8px;font-size:24px;word-break:break-word}
.sub{margin:0 0 16px;color:var(--muted);font-size:15px}

/* GRID â†’ vÅ¾dy 1 sloupec, pÅ™ebijeme i cizÃ­ CSS v parent strÃ¡nce */
.grid{
  display:grid;
  grid-template-columns:1fr !important;
  gap:12px;
}
.grid > div{min-width:0}

/* Form prvky â€“ nikdy nepÅ™eteÄou */
label{display:block;margin:2px 0 4px;font-weight:600;font-size:14px}
input,select,textarea{
  width:100%; max-width:100%; min-width:0; display:block;
  font:inherit; font-size:16px; /* iOS anti-zoom */
  padding:10px 12px;
  border:1.6px solid #c9d5ee; border-radius:12px; background:#f9fbff;
  transition:border-color .15s,box-shadow .15s,background .15s,transform .05s;
  -webkit-appearance:none; appearance:none;
}
input:hover,select:hover,textarea:hover{border-color:#b5c6ee}
input:focus,select:focus,textarea:focus{outline:0;border-color:var(--accent);box-shadow:0 0 0 3px var(--ring);background:#fff}
input[type="number"]{appearance:textfield}
textarea{min-height:90px;resize:vertical}

/* CTA */
.row-actions{display:flex;justify-content:center;margin-top:14px}
button{
  appearance:none;border:0;border-radius:14px;background:var(--accent);color:#fff;font-weight:700;
  padding:14px 18px; cursor:pointer; transition:background .15s,transform .05s;
  box-shadow:0 10px 22px rgba(37,99,235,.25); width:auto; min-width:160px; max-width:240px;
  font-size:clamp(15px,1.6vw,17px);
}
button:hover{background:var(--accent-d)} button:active{transform:translateY(1px)}
button.secondary{background:#e7eefc;color:var(--accent);box-shadow:none}
button.secondary:hover{background:#dbe6ff}

/* Stavy + animace + thanks */
.hidden{display:none!important}
.note{margin-top:10px;font-size:14px}
.ok{color:var(--ok)} .err{color:var(--err)}
.hp{position:absolute;left:-10000px;opacity:0}
.step{opacity:0;transform:translateY(8px);transition:opacity .18s ease,transform .18s ease}
.step.show{opacity:1;transform:translateY(0)}
.thanks{text-align:center;padding:14px 0}
.thanks h1{font-size:28px;margin-bottom:10px}
.thanks .sub{font-size:16px;margin-bottom:8px}

/* LehÄÃ­ rozmÄ›ry na velmi malÃ½ch displejÃ­ch */
@media (max-width:560px){
  .form-narrow{max-width:100%}
  .card{padding:16px}
  h1{font-size:20px}
  label{font-size:13px}
  input,select,textarea{padding:9px 11px}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="progress"><span id="progress-bar" style="width:33.333%"></span></div>

    <!-- KROK 1 -->
    <section id="step1" class="step show">
      <div class="form-narrow">
        <h1>ZjistÄ›te, kolik mÅ¯Å¾ete uÅ¡etÅ™it dÃ­ky naÅ¡emu Å™eÅ¡enÃ­ pro kontaktnÃ­ centra.</h1>
        <p class="sub">ÄŒÃ­m vÃ­ce ÃºdajÅ¯ vyplnÃ­te, tÃ­m pÅ™esnÄ›jÅ¡Ã­ vÃ½poÄet zÃ­skÃ¡te.</p>

        <div class="grid">
          <div><label for="agents_total">Kolik agentÅ¯ mÃ¡ vaÅ¡e kontaktnÃ­ centrum?</label><input id="agents_total" name="agents_total" type="number" min="0"></div>
          <div><label for="monthly_cost">JakÃ© jsou vaÅ¡e mÄ›sÃ­ÄnÃ­ nÃ¡klady na technologii? <em>(v KÄ)</em></label><input id="monthly_cost" name="monthly_cost" type="number" min="0" step="1"></div>
          <div><label for="calls_in_month">Kolik pÅ™Ã­chozÃ­ch hovorÅ¯ vyÅ™Ã­dÃ­te mÄ›sÃ­ÄnÄ›?</label><input id="calls_in_month" name="calls_in_month" type="number" min="0"></div>
          <div><label for="avg_in_sec">Jak dlouho trvÃ¡ prÅ¯mÄ›rnÃ½ pÅ™Ã­chozÃ­ hovor? <em>(v sekundÃ¡ch)</em></label><input id="avg_in_sec" name="avg_in_sec" type="number" min="0"></div>
          <div><label for="calls_out_month">Kolik odchozÃ­ch hovorÅ¯ uskuteÄnÃ­te mÄ›sÃ­ÄnÄ›?</label><input id="calls_out_month" name="calls_out_month" type="number" min="0"></div>
          <div><label for="avg_out_sec">Jak dlouho trvÃ¡ prÅ¯mÄ›rnÃ½ odchozÃ­ hovor? <em>(v sekundÃ¡ch)</em></label><input id="avg_out_sec" name="avg_out_sec" type="number" min="0"></div>
          <div>
            <label for="use_nonvoice">PouÅ¾Ã­vÃ¡te i jinÃ© neÅ¾ hlasovÃ© kanÃ¡ly? <em>(chat, e-mail, sociÃ¡lnÃ­ sÃ­tÄ›â€¦)</em></label>
            <select id="use_nonvoice" name="use_nonvoice">
              <option value="" selected disabled>Vyberteâ€¦</option>
              <option value="NE">NE</option>
              <option value="ANO">ANO</option>
            </select>
          </div>
          <div id="nonvoice_wrap" class="hidden">
            <label for="emails_month">Kolik e-mailÅ¯ odbavÃ­te mÄ›sÃ­ÄnÄ›?</label>
            <input id="emails_month" name="emails_month" type="number" min="0">
            <label for="chats_month" style="margin-top:8px">Kolik chatovÃ½ch zprÃ¡v mÄ›sÃ­ÄnÄ› odbavÃ­te?</label>
            <input id="chats_month" name="chats_month" type="number" min="0">
          </div>
        </div>

        <div class="row-actions">
          <button id="to_step2" type="button">DalÅ¡Ã­</button>
        </div>
      </div>
    </section>

    <!-- KROK 2 -->
    <section id="step2" class="step hidden">
      <div class="form-narrow">
        <h1>Pro vÃ½sledek prosÃ­m vyplÅˆte svÃ© Ãºdaje:</h1>
        <div class="grid">
          <div><label for="full_name">JmÃ©no a pÅ™Ã­jmenÃ­</label><input id="full_name" name="full_name"></div>
          <div><label for="company">SpoleÄnost</label><input id="company" name="company"></div>
          <div><label for="phone">Telefon</label><input id="phone" name="phone" inputmode="tel" placeholder="+420 123 456 789"></div>
          <div><label for="reply_to">E-mail</label><input id="reply_to" name="reply_to" type="email" placeholder="napÅ™. jana@firma.cz"></div>
        </div>

        <input class="hp" type="text" id="website" name="website" autocomplete="off" tabindex="-1" />

        <div class="row-actions">
          <button id="back_to_1" class="secondary" type="button">ZpÄ›t</button>
          <button id="submit_btn" type="button">SpoÄÃ­tat</button>
        </div>
        <p id="note" class="note"></p>
      </div>
    </section>

    <!-- KROK 3 -->
    <section id="step3" class="step hidden">
      <div class="form-narrow thanks">
        <h1>ğŸ‰ DÄ›kujeme za vyplnÄ›nÃ­!</h1>
        <p class="sub">NevychÃ¡zÃ­me z obecnÃ½ch odhadÅ¯ ani nÃ¡hodnÃ½ch ÄÃ­sel. KaÅ¾dÃ©mu klientovi se vÄ›nujeme individuÃ¡lnÄ› a vÃ½sledky stavÃ­me na reÃ¡lnÃ½ch datech.</p>
        <p class="sub">VÃ½poÄet vaÅ¡ich moÅ¾nÃ½ch Ãºspor vÃ¡m brzy zaÅ¡leme.</p>
        <p class="note ok" id="final_msg"></p>
      </div>
    </section>
  </div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
// ===== EmailJS â€“ tvoje Ãºdaje =====
const PUBLIC_KEY   = "vt8iib1leI62JB7YV";
const SERVICE_ID   = "service_hoq963k";
const TEMPLATE_ID_INTERNAL = "template_dyuy5ss";
const TEMPLATE_ID_CONFIRM  = null;
emailjs.init({ publicKey: PUBLIC_KEY });

// ===== DOM prvky =====
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');
const toStep2Btn = document.getElementById('to_step2');
const backTo1Btn = document.getElementById('back_to_1');
const submitBtn  = document.getElementById('submit_btn');
const useNonvoice  = document.getElementById('use_nonvoice');
const nonvoiceWrap = document.getElementById('nonvoice_wrap');
const note = document.getElementById('note');
const finalMsg = document.getElementById('final_msg');
const progress = document.getElementById('progress-bar');

// ===== PomÅ¯cky =====
function show(stepEl, pct){
  [step1, step2, step3].forEach(s => { s.classList.add('hidden'); s.classList.remove('show'); });
  stepEl.classList.remove('hidden'); requestAnimationFrame(()=> stepEl.classList.add('show'));
  progress.style.width = pct;
  // vÅ¾dy po zmÄ›nÄ› kroku pÅ™emÄ›Å™Ã­me vÃ½Å¡ku pro parent
  postHeight();
}

function v(id){ return (document.getElementById(id)?.value || '').trim(); }

// posun nahoru + Å™ekni rodiÄi, aÅ¥ posune taky
function scrollTopBoth(){
  try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch(e){ window.scrollTo(0,0); }
  try { window.parent.postMessage({ type: 'ALCASYS_CC_SCROLL_TOP' }, '*'); } catch(e){}
}

// poÅ¡li aktuÃ¡lnÃ­ vÃ½Å¡ku iframu rodiÄi
function postHeight(){
  if (!window.parent || window.parent === window) return;
  const h = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
  try { window.parent.postMessage({ type: 'ALCASYS_CC_CALC_HEIGHT', height: h }, '*'); } catch(e){}
}

// ===== NehlasovÃ© kanÃ¡ly =====
useNonvoice.addEventListener('change', () => {
  const showNV = useNonvoice.value === 'ANO';
  nonvoiceWrap.classList.toggle('hidden', !showNV);
  if (!showNV){
    document.getElementById('emails_month').value='';
    document.getElementById('chats_month').value='';
  }
  postHeight();
});

// ===== Kroky =====
toStep2Btn.addEventListener('click', () => { 
  show(step2, '66.666%'); 
  scrollTopBoth(); 
});

backTo1Btn?.addEventListener('click', () => { 
  note.textContent=''; 
  show(step1, '33.333%'); 
  scrollTopBoth(); 
});

// ===== Validace =====
function isValidEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
function isValidPhone(phone){
  const p = phone.replace(/\s{2,}/g,' ').trim();
  const re = /^(?:\d{3}\s?\d{3}\s?\d{3}|\+\d{1,3}\s?\d{3}\s?\d{3}\s?\d{3}|\+\d{1,3}\s?\d{9})$/;
  return re.test(p);
}

// ===== Data pro EmailJS =====
function collectPayload(){
  return {
    agents_total: v('agents_total'),
    calls_in_month: v('calls_in_month'),
    calls_out_month: v('calls_out_month'),
    avg_out_sec: v('avg_out_sec'),
    avg_in_sec: v('avg_in_sec'),
    monthly_cost: v('monthly_cost'),
    use_nonvoice: v('use_nonvoice') || 'NEUVEDENO',
    emails_month: v('emails_month'),
    chats_month: v('chats_month'),
    full_name: v('full_name'),
    company: v('company'),
    phone: v('phone'),
    reply_to: v('reply_to')
  };
}

// ===== OdeslÃ¡nÃ­ =====
submitBtn.addEventListener('click', async () => {
  note.textContent = '';
  if (document.getElementById('website')?.value){ return; } // honeypot

  const email = v('reply_to');
  const phone = v('phone');

  if (!email){ note.textContent = 'VyplÅˆ prosÃ­m e-mail.'; note.className = 'note err'; document.getElementById('reply_to').focus(); return; }
  if (!isValidEmail(email)){ note.textContent = 'Zadej prosÃ­m platnÃ½ e-mail (musÃ­ obsahovat â€@â€œ).'; note.className = 'note err'; document.getElementById('reply_to').focus(); return; }
  if (!phone){ note.textContent = 'VyplÅˆ prosÃ­m telefon.'; note.className = 'note err'; document.getElementById('phone').focus(); return; }
  if (!isValidPhone(phone)){ note.textContent = 'Telefon zadej ve formÃ¡tu 123456789, 123 456 789, +420123456789 nebo +420 123 456 789.'; note.className = 'note err'; document.getElementById('phone').focus(); return; }

  submitBtn.disabled = true; submitBtn.textContent = 'OdesÃ­lÃ¡mâ€¦';

  try{
    await emailjs.send(SERVICE_ID, TEMPLATE_ID_INTERNAL, collectPayload());
    if (TEMPLATE_ID_CONFIRM && email){ await emailjs.send(SERVICE_ID, TEMPLATE_ID_CONFIRM, collectPayload()); }

    show(step3, '100%');
    finalMsg.textContent = 'FormulÃ¡Å™ byl ÃºspÄ›Å¡nÄ› odeslÃ¡n.';
    scrollTopBoth(); // â¬†ï¸ posuÅˆ iframe i parent strÃ¡nku
  }catch(err){
    console.error(err);
    note.textContent = 'OdeslÃ¡nÃ­ se nepodaÅ™ilo. Zkuste to prosÃ­m znovu.'; note.className = 'note err';
  }finally{
    submitBtn.disabled = false; submitBtn.textContent = 'SpoÄÃ­tat';
    postHeight(); // pÅ™emÄ›Å™ vÃ½Å¡ku i na chybÄ›
  }
});

// ===== Auto-resize iframu: pÅ™emÄ›Å™uj vÃ½Å¡ku pÅ™i naÄtenÃ­ a zmÄ›nÃ¡ch =====
window.addEventListener('load', postHeight);
window.addEventListener('resize', postHeight);
new ResizeObserver(postHeight).observe(document.documentElement);
</script>

</body>
</html>
